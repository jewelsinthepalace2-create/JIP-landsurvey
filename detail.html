<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShepherdNet - Land Details</title>
  <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F2A20C">
    <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            shepherdDark: '#0F172A',
            shepherdCard: '#1E293B',
            shepherdGold: '#F2A20C',
          }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <style>
    html { transition: background-color 0.3s ease, color 0.3s ease; }
    .swiper-pagination-bullet-active { background-color: #F2A20C !important; }
    .swiper-button-next, .swiper-button-prev { color: #F2A20C !important; }
    /* Ensure videos fill the swiper container without distortion */
    video { object-fit: cover; width: 100%; height: 100%; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-shepherdDark dark:text-white min-h-screen pb-24 md:pb-8 font-sans transition-colors">

  <nav class="p-4 bg-white/80 dark:bg-shepherdCard/80 backdrop-blur-md shadow-md sticky top-0 z-50 flex justify-between items-center border-b border-gray-200 dark:border-slate-700 transition-colors">
    <div class="flex gap-4 items-center">
      <a href="index.html" class="text-shepherdGold font-bold flex items-center gap-2 hover:text-yellow-600 transition-colors">
        <span class="text-xl">‚Üê</span> <span class="hidden sm:inline">Back to Feed</span>
      </a>
      
      <div class="hidden md:flex gap-6 ml-8 font-medium border-l border-gray-300 dark:border-slate-600 pl-8">
        <a href="index.html" class="hover:text-shepherdGold transition-colors">Feed</a>
        <a href="survey.html" class="hover:text-shepherdGold transition-colors">Submit Survey</a>
        <a href="admin.html" class="hover:text-shepherdGold transition-colors">Admin</a>
      </div>
    </div>
    
    <button id="themeToggleBtn" class="flex items-center justify-center px-4 py-2 rounded-full font-bold text-sm bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors">
      ‚òÄÔ∏è Light
    </button>
  </nav>

  <main id="detailContainer" class="p-4 max-w-6xl mx-auto mt-2 sm:mt-6 w-full hidden">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-10">
      
      <div class="lg:col-span-1">
        <div class="w-full h-72 sm:h-96 md:h-[500px] bg-gray-200 dark:bg-black relative rounded-2xl overflow-hidden shadow-md border border-gray-200 dark:border-slate-700">
          <div class="swiper mySwiper w-full h-full">
            <div class="swiper-wrapper" id="swiperWrapper"></div>
            <div class="swiper-button-next hidden sm:flex bg-black/50 w-10 h-10 rounded-full !w-12 !h-12 !after:text-xl backdrop-blur-sm"></div>
            <div class="swiper-button-prev hidden sm:flex bg-black/50 w-10 h-10 rounded-full !w-12 !h-12 !after:text-xl backdrop-blur-sm"></div>
            <div class="swiper-pagination"></div>
          </div>
        </div>
      </div>

      <div class="lg:col-span-1 flex flex-col gap-6">
        <div class="bg-white dark:bg-shepherdCard p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 transition-colors">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-gray-500 dark:text-slate-300 text-sm font-bold uppercase tracking-wider mb-1">Asking Price</p>
              <h1 id="landPrice" class="text-3xl md:text-4xl font-extrabold text-shepherdGold"></h1>
            </div>
            <div class="text-right">
              <p class="text-gray-500 dark:text-slate-300 text-sm font-bold uppercase tracking-wider mb-1">Size</p>
              <p id="landSize" class="text-xl font-bold text-gray-900 dark:text-white bg-gray-100 dark:bg-slate-800 px-3 py-1 rounded-lg"></p>
            </div>
          </div>
        </div>

        <div class="bg-white dark:bg-shepherdCard p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 transition-colors">
          <h3 class="text-gray-900 dark:text-white font-bold mb-3 flex items-center gap-2 text-lg">üìç Location Details</h3>
          <p id="landLocation" class="text-gray-800 dark:text-slate-200 text-xl font-bold mb-1"></p>
          <p id="landLandmark" class="text-gray-500 dark:text-gray-400 text-md mb-5"></p>
          <a id="mapsLink" href="#" target="_blank" rel="noreferrer" class="inline-flex items-center justify-center w-full sm:w-auto px-6 py-3 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 font-bold rounded-xl hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors border border-blue-200 dark:border-blue-800">
            Open in Google Maps üó∫Ô∏è
          </a>
        </div>

        <div class="bg-white dark:bg-shepherdCard p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 transition-colors">
          <div>
            <p class="text-sm font-bold text-gray-500 dark:text-slate-300 mb-1 uppercase tracking-wider">Surveyed by</p>
            <p id="surveyorName" class="font-bold text-gray-900 dark:text-white text-lg flex items-center gap-2"></p>
          </div>
          <a id="surveyorCallBtn" href="#" class="w-full sm:w-auto text-center bg-gray-100 dark:bg-slate-700 text-gray-900 dark:text-white px-6 py-3 rounded-xl hover:bg-gray-200 dark:hover:bg-slate-600 font-bold transition-colors border border-gray-200 dark:border-slate-600 shadow-sm">
            Call Surveyor
          </a>
        </div>

        <div class="mt-2">
          <a id="caretakerCallBtn" href="#" class="flex justify-center items-center w-full bg-shepherdGold text-shepherdDark font-extrabold text-xl py-5 rounded-2xl shadow-lg hover:bg-yellow-500 hover:-translate-y-1 transition-all duration-200">
            üìû Call Land Owner / Caretaker
          </a>
        </div>
      </div>
    </div>
  </main>

  <div id="loadingState" class="flex flex-col justify-center items-center h-screen text-gray-900 dark:text-white gap-4">
    <div class="w-8 h-8 border-4 border-shepherdGold border-t-transparent rounded-full animate-spin"></div>
    <p class="font-bold">Loading land details...</p>
  </div>
  <div id="errorState" class="hidden flex flex-col justify-center items-center h-screen text-gray-900 dark:text-white gap-4">
    <p class="font-bold text-xl text-red-500">Property not found.</p>
    <a href="index.html" class="text-shepherdGold underline">Return to Feed</a>
  </div>

  <div class="md:hidden flex justify-around items-center p-4 bg-white dark:bg-shepherdCard fixed bottom-0 w-full shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-200 dark:border-slate-700 z-50 transition-colors">
    <a href="index.html" class="text-sm font-bold flex flex-col items-center text-gray-500 dark:text-gray-400 hover:text-shepherdGold transition-colors"><span>üó∫Ô∏è</span> Feed</a>
    <a href="survey.html" class="text-sm font-bold flex flex-col items-center text-gray-500 dark:text-gray-400 hover:text-shepherdGold transition-colors"><span>üìù</span> Survey</a>
    <a href="admin.html" class="text-sm font-bold flex flex-col items-center text-gray-500 dark:text-gray-400 hover:text-shepherdGold transition-colors"><span>‚öôÔ∏è</span> Admin</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <script>
    const htmlElement = document.documentElement;
    const themeBtn = document.getElementById('themeToggleBtn');
    let isDarkMode = localStorage.getItem('theme') !== 'light';
    
    function updateThemeUI() {
      if (isDarkMode) {
        htmlElement.classList.add('dark');
        themeBtn.textContent = '‚òÄÔ∏è Light';
      } else {
        htmlElement.classList.remove('dark');
        themeBtn.textContent = 'üåô Dark';
      }
    }
    updateThemeUI();
    themeBtn.addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
      updateThemeUI();
    });

    const WORKER_URL = 'https://lucky-water-ff71.jewelsinthepalace2.workers.dev'; 
    const urlParams = new URLSearchParams(window.location.search);
    const landId = urlParams.get('id');

    async function fetchLandDetail() {
      if (!landId) {
        document.getElementById('loadingState').classList.add('hidden');
        document.getElementById('errorState').classList.remove('hidden');
        return;
      }

      try {
        const response = await fetch(`${WORKER_URL}/api/lands/${landId}`);
        const land = await response.json();

        document.getElementById('loadingState').classList.add('hidden');
        if (!land || land.error) {
          document.getElementById('errorState').classList.remove('hidden');
          return;
        }

        document.getElementById('detailContainer').classList.remove('hidden');

        // Text Data
        document.getElementById('landPrice').textContent = `GH‚Çµ ${Number(land.price).toLocaleString()}`;
        document.getElementById('landSize').textContent = land.land_size || land.size;
        document.getElementById('landLocation').textContent = land.landmark;
        document.getElementById('landLandmark').textContent = `Coordinates: ${land.latitude}, ${land.longitude}`;
        document.getElementById('surveyorName').innerHTML = `üë§ ${land.surveyorName || 'Team Member'}`;
        
        // Links
        document.getElementById('mapsLink').href = `https://www.google.com/maps?q=${land.latitude},${land.longitude}`;
        document.getElementById('surveyorCallBtn').href = `tel:${land.surveyorContact || ''}`;
        document.getElementById('caretakerCallBtn').href = `tel:${land.caretaker_contact || land.caretakerContact}`;

        // MEDIA RENDERING (Images & Videos)
        const swiperWrapper = document.getElementById('swiperWrapper');
        const images = land.images ? JSON.parse(land.images) : [];
        const videos = land.videos ? JSON.parse(land.videos) : [];

        // Combine media into one gallery
        const allMedia = [
          ...images.map(url => ({ url, type: 'image' })),
          ...videos.map(url => ({ url, type: 'video' }))
        ];

        // Fallback if empty
        if (allMedia.length === 0) {
           allMedia.push({ url: "https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80", type: 'image' });
        }

        allMedia.forEach(media => {
          const slide = document.createElement('div');
          slide.className = 'swiper-slide flex items-center justify-center bg-black';
          
          if (media.type === 'video') {
            slide.innerHTML = `
              <video controls playsinline preload="metadata" class="max-h-full">
                <source src="${media.url}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            `;
          } else {
            slide.innerHTML = `<img src="${media.url}" alt="Land" class="w-full h-full object-cover">`;
          }
          swiperWrapper.appendChild(slide);
        });

        // Init Swiper
        const swiper = new Swiper(".mySwiper", {
          loop: false, // Set to false to prevent video restart glitches on loop
          pagination: { el: ".swiper-pagination", clickable: true },
          navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
        });

      } catch (err) {
        console.error(err);
        document.getElementById('loadingState').classList.add('hidden');
        document.getElementById('errorState').classList.remove('hidden');
      }
    }

    fetchLandDetail();
  </script>
</body>
</html>